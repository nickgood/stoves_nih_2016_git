---
title: "Startup Manuscript"
output: html_document
---

```{r global_options, include = FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/',
                        warning = FALSE,
                        message = FALSE,
                        fig.width = 10, fig.height = 4,
                        cache = FALSE)
```

```{r setup, include=FALSE}
  library(tidyverse)
  library(knitr)
  library(dunn.test)
  library(lsmeans)
  library(pairwiseCI)
  library(corrplot)
  source("../r_scripts/R_functions.R")
```

```{r read data, include=FALSE}
  emission_factors <- readRDS(file = "../r_files/emission_factors.RDS")
  fuel_burnt_reps <- readRDS(file = "../r_files/fuel_burnt_reps.RDS")
  qc <- readRDS(file = "../r_files/qc.RDS")
  mce_summary <- readRDS(file = "../r_files/mce_summary.RDS")
  mce_summary_per_test <- readRDS(file = "../r_files/mce_summary_per_test.RDS")
```

```{r}
  jvPalette <- c("#330099","#CC0066","#FF6633", 
                 "#0099CC", "#FF9900","#CC6633",
                  "#FF3366", "#33CC99", "#339999")
```

# Results

## Prepare data

* calculate mean fuel consumed per fuel type

```{r, include = FALSE}
  fuel_consumed <- fuel_burnt_reps %>%
                   dplyr::left_join(dplyr::select(qc, id, qc),
                                                  by = "id") %>%
                   dplyr::filter(!is.na(dm), qc != "bad") %>%
                   dplyr::mutate(dur = (off - on) / 60) %>%
                   dplyr::group_by(fuel) %>%
                   dplyr::summarise(mean_dm = mean(dm),
                                    min_dm = min(dm),
                                    max_dm = max(dm),
                                    total_dm = sum(dm),
                                    mean_burn_time = round(mean(dur), 1), #in minutes per startup
                                    min_burn_time = round(min(dur), 1),
                                    max_burn_time = round(max(dur), 1),
                                    num_reps = n()) %>%
                   dplyr::mutate(fuel = forcats::fct_relevel(fuel,
                                                             "background", "kerosene",
                                                             "leaves_twigs", "flipflops",
                                                             "rubber", "newspaper",
                                                             "wood_shims", "t_shirts",
                                                             "food_packaging", "plastic_bags")) %>%
                   dplyr::mutate(fuel = forcats::fct_drop(fuel, "blank")) %>%
                   dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                   "kindling" = "leaves_twigs",
                                                                   "inner tubes" = "rubber",
                                                                   "footwear" = "flipflops",
                                                                   "fabric" = "t_shirts",
                                                                   "wood shims" = "wood_shims",
                                                                   "food packaging" = "food_packaging"))

  kable(fuel_consumed, digits = 3)
```

* calculate emissions metrics

```{r, echo = FALSE}
# set variable types from character -> factor
# filter out bad QC data
# set fuel type order by survey result "commonality" of use. 
# create variable mass (g) pollutant emitted per startup event
# create variable average mass (g) of startup material per startup event
# filter out backgrounds and blanks
  per_test <- dplyr::mutate(emission_factors, fuel = factor(fuel),
                                              qc = factor(qc),
                                              pol = factor(pol)) %>%
              dplyr::rename(mass_emitted = value) %>%
              dplyr::select(-metric) %>%
              dplyr::filter(qc != "bad") %>%
              dplyr::mutate(fuel = forcats::fct_relevel(fuel, "background", "kerosene",
                                                              "leaves_twigs", "flipflops",
                                                              "rubber", "newspaper",
                                                              "wood_shims", "t_shirts",
                                                              "food_packaging", "plastic_bags")) %>%
              dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                   "kindling" = "leaves_twigs",
                                                                   "inner tubes" = "rubber",
                                                                   "footwear" = "flipflops",
                                                                   "fabric" = "t_shirts",
                                                                   "wood shims" = "wood_shims",
                                                                   "food packaging" = "food_packaging"),
                            mass_pol_per_startup = (mass_emitted * 1e-3) / fuel_quant, # mg per startup event
                            mass_fuel_per_startup = fuelmass_total / fuel_quant, # g per startup event
                            mass_pol_per_mass_fuel = (mass_emitted * 1e-3) / fuelmass_total) %>%  # mg/g (same as g/kg)
              dplyr::filter(!grepl("^B", id_test)) %>%
              dplyr::left_join(dplyr::select(fuel_consumed, fuel_names, mean_dm),
                               by = "fuel_names") %>%
              dplyr::mutate(fuel_quant_std = fuelmass_total / mean_dm,
                            mass_pol_per_startup_std = (mass_emitted * 1e-3) / fuel_quant_std) # mg/standard startup

```

* QC comparison - standardized "startup event" vs. per-test average startup event
```{r, include = FALSE, fig.width = 15, fig.height = 18, eval = FALSE}
ggplot(per_test) +
geom_point(aes(x= id, y=mass_pol_per_startup), size = 2, color = 'red') +
  geom_point(aes(x=id, y=mass_pol_per_startup_std), size = 2, color = 'black') +
    facet_wrap(~pol, scales = "free", ncol = 3) +
  theme_bw() +
  theme(legend.position = "top")
```

## Table 1

* experiment summary

```{r, echo = FALSE}
  fuel_sum <- dplyr::filter(per_test, pol == 'grav') %>% 
              dplyr::group_by(fuel_names) %>%
              dplyr::summarize(n_tests = n(),
                               n_events_per_test = round(mean(fuel_quant), 2),
                               min_events_per_test = min(fuel_quant),
                               max_events_per_test = max(fuel_quant),
                               n_events_per_test_std = round(mean(fuel_quant_std), 2),
                               min_events_per_test_std = round(min(fuel_quant_std), 2),
                               max_events_per_test_std = round(max(fuel_quant_std), 2)) %>%
             dplyr::left_join(select(fuel_consumed, -fuel, -num_reps), by = "fuel_names") %>%
             dplyr::mutate(mean_dm = round(mean_dm, 1),
                           max_dm = round(max_dm, 1),
                           total_dm = round(total_dm, 1))

knitr::kable(fuel_sum)
```

## Table 2

* emissions per startup event (mg per startup event), average per test

```{r, echo = FALSE}
  mean_per_startup <- per_test %>%
                      dplyr::group_by(inst, fuel_names, pol) %>%
                      dplyr::summarize(nreps = n(),
                                   mean = mean(mass_pol_per_startup_std, na.rm = TRUE),
                                   min = min(mass_pol_per_startup_std, na.rm = TRUE),
                                   max = max(mass_pol_per_startup_std, na.rm = TRUE),
                                   stdev = sd(mass_pol_per_startup_std, na.rm = TRUE),
                                   cov = round(((stdev/mean) * 100), 2),
                                   variation_pct = round(((max - min) / max)*100, 0),
                                   variation_act = round((max - min), 2)) %>%
                      dplyr::ungroup() %>%
                      dplyr::mutate(mean_round = ifelse(inst == "carbs" | inst == "voc", round(mean, 1), 
                                                        round(mean,0)),
                                    min_round = ifelse(inst == "carbs" | inst == "voc", round(min, 1),
                                                       round(min,0)),
                                    max_round = ifelse(inst == "carbs" | inst == "voc", round(max, 1),
                                                       round(max,0)),
                                    result_table = paste0(mean_round, " (", min_round, ", ", max_round, ")"))

  

  mean_per_startup_table <- mean_per_startup %>%
                            dplyr::select(fuel_names, pol, result_table, inst) %>%
                            tidyr::spread(fuel_names, result_table) %>%
                            dplyr::arrange(inst)

  write_csv(mean_per_startup_table, "../r_files/mean_per_startup_table.csv")

  knitr::kable(mean_per_startup_table)
```

## Supplemental Table 1

* emissions per mass fuel (mg per g fuel (same as g/kg))

```{r, echo = FALSE}
  per_fuel_mass <- per_test %>%
                      dplyr::group_by(inst, fuel_names, pol) %>%
                      dplyr::summarize(nreps = n(),
                                   mean = mean(mass_pol_per_mass_fuel, na.rm = TRUE),
                                   min = min(mass_pol_per_mass_fuel, na.rm = TRUE),
                                   max = max(mass_pol_per_mass_fuel, na.rm = TRUE)) %>%
                      dplyr::ungroup() %>%
                      dplyr::mutate(mean_round = ifelse(inst == "carbs" | inst == "voc", round(mean, 1), 
                                                        round(mean,0)),
                                    min_round = ifelse(inst == "carbs" | inst == "voc", round(min, 1),
                                                       round(min,0)),
                                    max_round = ifelse(inst == "carbs" | inst == "voc", round(max, 1),
                                                       round(max,0)),
                                    result_table = paste0(mean_round, " (", min_round, ", ", max_round, ")"))

  per_fuel_mass_table <- per_fuel_mass %>%
                            dplyr::select(fuel_names, pol, result_table, inst) %>%
                            tidyr::spread(fuel_names, result_table) %>%
                            dplyr::arrange(inst)

  write_csv(per_fuel_mass_table, "../r_files/mean_per_fuel_mass_table.csv")

  knitr::kable(per_fuel_mass_table)
```

## Figure 1.

* emissions of key pollutants (standardized calc)

```{r, echo = FALSE, fig.width = 12, fig.height = 15}
  p_data_key <- dplyr::filter(per_test, grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>% 
                dplyr::mutate(pol = sub("^voc_", "", pol),
                              pol = sub("^grav", "PM2.5", pol),
                              pol = sub("co", "carbon monoxide", pol),
                              pol = sub("ec", "elemental carbon", pol),
                              pol = sub("oc", "organic carbon", pol)) %>%
                dplyr::mutate(pol = forcats::fct_relevel(pol, "PM2.5", "carbon monoxide", "elemental carbon", 
                                                              "organic carbon", "formaldehyde", "acetaldehyde",
                                                              "benzene", "toluene")) #%>%
                #dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "kerosene", "wood shims", "kindling", 
                #                                                       "newspaper", "fabric", 
                #                                                       "plastic bags", "food packaging", 
                #                                                       "inner tubes", "footwear"))

  p_data_key_means <- dplyr::filter(mean_per_startup, grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                      dplyr::mutate(pol = sub("^voc_", "", pol),
                                    pol = sub("^grav", "PM2.5", pol))%>%
                      dplyr::mutate(pol = forcats::fct_relevel(pol, "PM2.5", "ec", "oc", "co",
                                                                    "formaldehyde", "acetaldehyde",
                                                                    "benzene", "toluene"))

  ggplot(p_data_key, aes(fuel_names, mass_pol_per_startup_std, color = fuel)) +
  geom_point(size = 5, shape = 1, stroke = 2) +
  theme_bw() +
  theme(legend.position = "none",
        panel.spacing.y = unit(1.5,"lines"),
        panel.spacing.x = unit(0,"lines"),
        text = element_text(size=30),
        axis.text.x = element_text(angle = 45, hjust = 1, size = 25),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 25))) +
  scale_y_log10(breaks = c(0, 0.1, 0.5, 1, 3, 10, 25, 100, 500, 1000)) + 
  ylab("mg per startup event") + xlab("") +
  scale_color_manual(values = jvPalette) +
  facet_wrap(~pol, scales = "free_y", ncol = 2)
```

## Supplemental Figure 1.

* emissions of key pollutants (mass per mass fuel basis)

```{r, echo = FALSE, fig.width = 12, fig.height = 17.5}
  p_data_key_reorder <- p_data_key %>%
                        dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "inner tubes", "footwear", 
                                                                        "kerosene", "kindling",
                                                                       "newspaper", "fabric", "food packaging",
                                                                       "wood shims", "plastic bags"))

  ggplot(p_data_key_reorder, aes(fuel_names, mass_pol_per_mass_fuel, color = fuel)) +
  geom_point(size = 5, shape = 1, stroke = 2) +
    theme_bw() +
  theme(legend.position = "none",
        text = element_text(size=25),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 25))) +
  scale_y_log10(breaks = c(0, 0.05, 0.1, 0.5, 1, 5, 10, 20, 40, 80)) +
  ylab("Emissions Factor (g/kg)") + xlab("Fuel Type") +
  scale_color_manual(values = jvPalette) +
  facet_wrap(~pol, scales = "free", ncol = 2)
```


## pairwise comparisons of key pollutants (for text)

### PM2.5

* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  grav_means <- dplyr::filter(p_data_key, grepl('^PM2.5$', pol))

  #pm_cont <- lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = grav_means)), pairwise ~ fuel_names, adjust = "none")

  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = grav_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 0), " (", round(lower, 0), ", ", round(upper, 0), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/pm25_contrasts.csv")

  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = grav_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = grav_means$mass_pol_per_startup_std, g = grav_means$fuel_names, method = "none")
```

### CO

* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  co_means <- dplyr::filter(p_data_key, grepl('^carbon monoxide$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = co_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = co_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 0), " (", round(lower, 0), ", ", round(upper, 0), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/co_contrasts.csv")

  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = co_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = co_means$mass_pol_per_startup_std, g = co_means$fuel_names, method = "none")
```

### formaldehyde
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  for_means <- dplyr::filter(p_data_key, grepl('^formaldehyde$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = for_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = for_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/formaldehyde_contrasts.csv")
  
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = for_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = for_means$mass_pol_per_startup_std, g = for_means$fuel_names, method = "none")
```

### acetaldehyde
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  acet_means <- dplyr::filter(p_data_key, grepl('^acetaldehyde$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = acet_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = acet_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/acetaldehyde_contrasts.csv")
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = acet_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = acet_means$mass_pol_per_startup_std, g = acet_means$fuel_names, method = "none")
```

### benzene
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  bz_means <- dplyr::filter(p_data_key, grepl('^benzene$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = bz_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = bz_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/benzene_contrasts.csv")
  
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = bz_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = bz_means$mass_pol_per_startup_std, g = bz_means$fuel_names, method = "none")
```

### toluene
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  tol_means <- dplyr::filter(p_data_key, grepl('^toluene$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = tol_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = tol_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/toluene_contrasts.csv")
  
  knitr::kable(df)
```

*Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = tol_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = tol_means$mass_pol_per_startup_std, g = tol_means$fuel_names, method = "none")
```

# variations in emissions for key pollutants (for text) 

* variation in emissions per test for key pollutants - coefficient of variation (COV)

```{r, echo = FALSE}
var_per_fuel_cov <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>% 
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, cov) %>%
                            tidyr::spread(fuel_names, cov) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_cov)
```

* variation in emissions per test for key pollutants - actual value variation min to max (g/startup). 

```{r, echo = FALSE}
var_per_fuel_act <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, variation_act) %>%
                            tidyr::spread(fuel_names, variation_act) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_act)
```

* variation in emissions per test for key pollutants - - percent variation min to max 

```{r, echo = FALSE}
var_per_fuel_pct <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, variation_pct) %>%
                            tidyr::spread(fuel_names, variation_pct) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_pct)
```

## Figure 3.

* stacked bar charts of health relevent pollutant categories.

```{r, echo = FALSE, fig.width = 9, fig.height = 4}
  voc_cats <- mean_per_startup %>%
              dplyr::filter(pol == "voc_benzene" |
                            pol == "voc_toluene" |
                            pol == "voc_ethylbenzene" |
                            pol == "voc_m_p_xylene" |
                            pol == "voc_o_xylene") %>%
              dplyr::mutate(cat = "BTEX") %>%
              dplyr::mutate(pol = sub("^voc_", "", pol),
                             pol = sub(".*xylene.*", "xylenes", pol)) %>%
              dplyr::mutate(pol = factor(pol, levels = c("benzene", "toluene", "ethylbenzene", "xylenes")))

  voc_palette <- c("#339999", "#33CC99", "#0099CC", "#330099")

  voc_plot <- ggplot(voc_cats, aes(fuel_names, mean)) +
                geom_col(aes(fill = pol), position = "stack") +
                theme_bw() +
                theme(legend.position = "top",text = element_text(size=15),
                      axis.title.x=element_blank(),
                      legend.title=element_blank(),
                      axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                      #axis.text.x = element_text(angle = 30, hjust = 1),
                      axis.text.x = element_blank()) +
                scale_fill_manual(values = voc_palette) +
                ylab("mg per startup event") +
                ylim(0,30) 

  voc_plot_zoom <- ggplot(voc_cats, aes(fuel_names, mean)) +
                    geom_col(aes(fill = pol), position = "stack") +
                    theme_bw() +
                    theme(legend.position = "none",
                          axis.title.x=element_blank(),
                          legend.title=element_blank(),
                          axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                          axis.text.x = element_text(angle = 30, hjust = 1, size = 13)) +
                    scale_fill_manual(values = voc_palette) +
                    ylab("mg per startup event") +
                    ylim(0,5) 
  
#spread and save as CSV for plotting in Igor
  voc_cats_spread <- mean_per_startup %>%
                     dplyr::filter(pol == "voc_benzene" |
                                   pol == "voc_toluene" |
                                   pol == "voc_ethylbenzene" |
                                   pol == "voc_m_p_xylene" |
                                   pol == "voc_o_xylene") %>%
                    dplyr::mutate(cat = "BTEX") %>%
                    dplyr::mutate(pol = sub("^voc_", "", pol)) %>%
                    select(fuel_names, pol, mean) %>%
                    tidyr::spread(pol, mean) %>%
                    dplyr::mutate(xylenes = m_p_xylene + o_xylene) %>%
                    dplyr::select(-m_p_xylene, -o_xylene) %>%
                    write_csv("../r_files/voc_cats_spread.csv")

```

```{r}
  pm_ec_oc <- mean_per_startup %>%
              dplyr::filter(pol == "ec" |
                            pol == "oc" |
                            pol == "grav") %>%
              dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                       "newspaper", "fabric", 
                                                                       "plastic bags", "food packaging", 
                                                                       "inner tubes", "footwear"))) %>%
              dplyr::mutate(mean = ifelse(mean < 0, 0, mean)) %>% # deals with negative plastic bag ecoc
              dplyr::mutate(pol = sub("ec", "elemental carbon", pol),
                            pol = sub("oc", "organic carbon", pol),
                            pol = sub("grav", "PM2.5 mass", pol),
                            pol = factor(pol, levels = c("elemental carbon", "organic carbon", "PM2.5 mass")))

  data_ec_oc <- pm_ec_oc %>%
                filter(inst == "ecoc")
 
  data_pm25 <- pm_ec_oc %>%
                filter(inst == "grav")
  
  pm_palette <- c("elemental carbon" = "grey65", "organic carbon" = "palegreen3", "PM2.5 mass" = "grey30")

  pm_plot <- ggplot(mapping = aes(fuel_names, mean)) +
              geom_col(data = data_pm25, aes(fill = pol)) +
              geom_col(aes(fill = pol), data_ec_oc, position = "stack") +
              scale_fill_manual(values = pm_palette) +
              theme_bw() +
              theme(legend.position = "top",text = element_text(size=15),
                    legend.title=element_blank(),
                    axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                    #axis.text.x = element_text(angle = 30, hjust = 1),
                    axis.text.x = element_blank(),
                    axis.title=element_blank())
  
  pm_plot_zoom <- ggplot(mapping = aes(fuel_names, mean)) +
                   geom_col(data = data_pm25, aes(fill = pol)) +
                   geom_col(aes(fill = pol), data_ec_oc, position = "stack") +
                   scale_fill_manual(values = pm_palette) +
                   theme_bw() +
                   theme(legend.position = "none",
                         legend.title=element_blank(),
                         axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                         axis.text.x = element_text(angle = 30, hjust = 1, size = 13),
                         axis.title=element_blank()) +
                   ylim(0,50) 

  # spread and save as csv for plotting in Igor
  pm_ec_oc_spread <- pm_ec_oc %>% 
                     select(fuel_names, pol, mean) %>%
                     tidyr::spread(key = pol, value = mean) %>%
                     write_csv("../r_files/pm_ec_oc_spread.csv")
```

```{r, echo = FALSE, fig.width = 10, fig.height = 10}
#gridExtra::grid.arrange(voc_plot, pm_plot, voc_plot_zoom, pm_plot_zoom, ncol = 2)
```

## Supplemental Figure 2. 

* stacked bar charts of health relevent pollutant categories - 

```{r, echo = FALSE, fig.width = 9, fig.height = 4}

  voc_cats_fuelmass <- per_fuel_mass %>%
              dplyr::filter(pol == "voc_benzene" |
                            pol == "voc_toluene" |
                            pol == "voc_ethylbenzene" |
                            pol == "voc_m_p_xylene" |
                            pol == "voc_o_xylene") %>%
              dplyr::mutate(cat = "BTEX") %>%
              dplyr::mutate(pol = sub("^voc_", "", pol),
                             pol = sub(".*xylene.*", "xylenes", pol)) %>%
              dplyr::mutate(pol = factor(pol, levels = c("benzene", "toluene", "ethylbenzene", "xylenes")))

  voc_palette <- c("#339999", "#33CC99", "#0099CC", "#330099")

  voc_plot_sup <- ggplot(voc_cats_fuelmass, aes(fuel_names, mean)) +
                geom_col(aes(fill = pol), position = "stack") +
                theme_bw() +
                theme(legend.position = "top",text = element_text(size=15),
                      axis.title.x=element_blank(),
                      legend.title=element_blank(),
                      axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                      axis.text.x = element_text(angle = 30, hjust = 1, size = 13)) +
                scale_fill_manual(values = voc_palette) +
                ylab("mg per startup event") +
                ylim(0,2) 
  
#spread and save as CSV for plotting in Igor
  voc_cats_spread_fuelmass <- per_fuel_mass %>%
                     dplyr::filter(pol == "voc_benzene" |
                                   pol == "voc_toluene" |
                                   pol == "voc_ethylbenzene" |
                                   pol == "voc_m_p_xylene" |
                                   pol == "voc_o_xylene") %>%
                    dplyr::mutate(cat = "BTEX") %>%
                    dplyr::mutate(pol = sub("^voc_", "", pol)) %>%
                    select(fuel_names, pol, mean) %>%
                    tidyr::spread(pol, mean) %>%
                    dplyr::mutate(xylenes = m_p_xylene + o_xylene) %>%
                    dplyr::select(-m_p_xylene, -o_xylene) %>%
                    write_csv("../r_files/voc_cats_spread_fuelmass.csv")

```

```{r}
  pm_ec_oc_fuelmass <- per_fuel_mass %>%
              dplyr::filter(pol == "ec" |
                            pol == "oc" |
                            pol == "grav") %>%
              dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                       "newspaper", "fabric", 
                                                                       "plastic bags", "food packaging", 
                                                                       "inner tubes", "footwear"))) %>%
              dplyr::mutate(mean = ifelse(mean < 0, 0, mean)) %>% # deals with negative plastic bag ecoc
              dplyr::mutate(pol = sub("ec", "elemental carbon", pol),
                            pol = sub("oc", "organic carbon", pol),
                            pol = sub("grav", "PM2.5 mass", pol),
                            pol = factor(pol, levels = c("elemental carbon", "organic carbon", "PM2.5 mass")))

  data_ec_oc_sup <- pm_ec_oc_fuelmass %>%
                filter(inst == "ecoc")
 
  data_pm25_sup <- pm_ec_oc_fuelmass %>%
                filter(inst == "grav")
  
  pm_palette <- c("elemental carbon" = "grey65", "organic carbon" = "palegreen3", "PM2.5 mass" = "grey30")

  pm_plot_sup <- ggplot(mapping = aes(fuel_names, mean)) +
              geom_col(data = data_pm25_sup, aes(fill = pol)) +
              geom_col(aes(fill = pol), data_ec_oc_sup, position = "stack") +
              scale_fill_manual(values = pm_palette) +
              theme_bw() +
              theme(legend.position = "top",text = element_text(size=15),
                    legend.title=element_blank(),
                    axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11),
                    axis.text.x = element_text(angle = 30, hjust = 1, size = 13),
                    axis.title=element_blank()) +
                    ylim(0,35) 

  # spread and save as csv for plotting in Igor
  pm_ec_oc_spread <- pm_ec_oc_fuelmass %>% 
                     select(fuel_names, pol, mean) %>%
                     tidyr::spread(key = pol, value = mean) %>%
                     write_csv("../r_files/pm_ec_oc_spread_fuelmass.csv")
```

```{r, echo = FALSE, fig.width = 9.25, fig.height = 5}
  gridExtra::grid.arrange(voc_plot_sup, pm_plot_sup, ncol = 2)
```

# Correlations

```{r, echo =FALSE, fig.width = 15, fig.height = 15}
  cor_data <- per_fuel_mass %>%
              dplyr::select(-inst, -nreps, -min, -max) %>%
              dplyr::mutate(mean = as.numeric(mean)) %>%
              dplyr::select(fuel_names, pol, mean) %>%
              tidyr::spread(pol, mean) %>%
              dplyr::select(-fuel_names, -m_p_tolualdehyde) %>%
              dplyr::mutate_all(as.numeric) %>%
              dplyr::rename(dimethylbenzaldehyde = "2_5_dimethylbenzaldehyde") %>%
              dplyr::select(-dimethylbenzaldehyde)

  cors <-(cor(cor_data, method = "spearman"))

  corrplot.mixed(cors, lower.col = "black", upper = "color", number.cex = 1, tl.pos = "lt", diag = "l")

```


## Supplemental Figure 3
### scatterplots (using g/kg EFs)
```{r}
# add MCE to per_fuel_mass and per_test data

  mce_summary_ <- mce_summary %>%
                  dplyr::mutate(inst = "MCE",
                                pol = "MCE") %>%
                  dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                       "kindling" = "leaves_twigs",
                                                                       "inner tubes" = "rubber",
                                                                       "footwear" = "flipflops",
                                                                       "fabric" = "t_shirts",
                                                                       "wood shims" = "wood_shims",
                                                                       "food packaging" = "food_packaging")) %>%
                  dplyr::select(inst, pol, fuel_names, mean)

  per_fuel_mass <- per_fuel_mass %>%
                   bind_rows(mce_summary_) %>%
                   dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "background", "kerosene",
                                                                               "kindling", "flipflops",
                                                                               "rubber", "newspaper",
                                                                               "wood shims", "t shirts",
                                                                               "food packaging", "plastic bags"))


  mce_summary_per_test_ <- mce_summary_per_test %>%
                           dplyr::mutate(inst = "MCE",
                                         pol = "MCE",
                                         mass_pol_per_mass_fuel = mean) %>%
                           dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                                "kindling" = "leaves_twigs",
                                                                                "inner tubes" = "rubber",
                                                                                "footwear" = "flipflops",
                                                                                "fabric" = "t_shirts",
                                                                                "wood shims" = "wood_shims",
                                                                                "food packaging" = "food_packaging")) %>%
                          dplyr::select(id, pol, inst, fuel_names, mass_pol_per_mass_fuel)
  
  per_test <- per_test %>%
              bind_rows(mce_summary_per_test_) %>%
              dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "background", "kerosene",
                                                                          "kindling", "flipflops",
                                                                          "rubber", "newspaper",
                                                                          "wood shims", "t shirts",
                                                                          "food packaging", "plastic bags"))
```


```{r, echo=FALSE, fig.width = 7.5}
# PM vs CO
  pmco <- dplyr::filter(per_fuel_mass, grepl('^grav$|^co$', pol)) %>%
          dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                          fuel_names == 'kerosene' |
                                          fuel_names == 'wood shims' | 
                                          fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  pmco_pertest <- dplyr::filter(per_test, grepl('^grav$|^co$', pol)) %>%
                  dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                  tidyr::spread(pol, mass_pol_per_mass_fuel)
  
 # rho calculations
  rho_sp <- cor(pmco$grav, pmco$co, method = "spearman")
  rho_pear <- cor(pmco$grav, pmco$co, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = pmco, aes(x = grav, y = co, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = pmco_pertest, aes(x = grav, y = co, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 50, y = 50, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 48, y = 46, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("carbon monoxide") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
#formaldehyde vs acetaldehyde
  carbs <- dplyr::filter(per_fuel_mass, grepl('^formaldehyde$|^acetaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  carbs_pertest <- dplyr::filter(per_test, grepl('^formaldehyde$|^acetaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)
  
 # rho calculations
  rho_sp <- cor(carbs$formaldehyde, carbs$acetaldehyde, method = "spearman")
  rho_pear <- cor(carbs$formaldehyde, carbs$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))
  
  ggplot() + 
          geom_point(data = carbs, aes(x = formaldehyde, y = acetaldehyde, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = carbs_pertest, aes(x = formaldehyde, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 0.56, y = 1.15, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 0.52, y = 1.05, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("acetaldehyde") +
          xlab("formaldehyde") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# benzene vs toluene
  voc <- dplyr::filter(per_fuel_mass, grepl('^voc_benzene$|^voc_toluene$', pol)) %>%
         dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                         fuel_names == 'kerosene' |
                                         fuel_names == 'wood shims' | 
                                         fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  voc_pertest <- dplyr::filter(per_test, grepl('^voc_benzene$|^voc_toluene$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(voc$voc_benzene, voc$voc_toluene, method = "spearman")
  rho_pear <- cor(voc$voc_benzene, voc$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))
  

  ggplot() +
          geom_point(data = voc, aes(x = voc_benzene, y = voc_toluene, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = voc_pertest, aes(x = voc_benzene, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 0.4, y = 0.242, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 0.36, y = 0.225, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("toluene") +
          xlab("benzene") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# PM vs formaldehyde
  pmfor <- dplyr::filter(per_fuel_mass, grepl('^grav$|^formaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  pmfor_pertest <- dplyr::filter(per_test, grepl('^grav$|^formaldehyde$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmfor$grav, pmfor$formaldehyde, method = "spearman")
  rho_pear <- cor(pmfor$grav, pmfor$formaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmfor, aes(x = grav, y = formaldehyde, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = pmfor_pertest, aes(x = grav, y = formaldehyde, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 47, y = 1.55, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 45, y = 1.45, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("formaldehyde") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# PM vs acetaldehyde
pmacet <- dplyr::filter(per_fuel_mass, grepl('^grav$|^acetaldehyde$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmacet_pertest <- dplyr::filter(per_test, grepl('^grav$|^acetaldehyde$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmacet$grav, pmacet$acetaldehyde, method = "spearman")
  rho_pear <- cor(pmacet$grav, pmacet$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmacet, aes(x = grav, y = acetaldehyde, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = pmacet_pertest, aes(x = grav, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 50, y = 1.15, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 48, y = 1.05, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("acetaldehyde") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```


```{r, echo=FALSE, fig.width = 7.5}
# PM vs benzene
pmbenz <- dplyr::filter(per_fuel_mass, grepl('^grav$|^voc_benzene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmbenz_pertest <- dplyr::filter(per_test, grepl('^grav$|^voc_benzene$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmbenz$grav, pmbenz$voc_benzene, method = "spearman")
  rho_pear <- cor(pmbenz$grav, pmbenz$voc_benzene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmbenz, aes(x = grav, y =voc_benzene, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = pmbenz_pertest, aes(x = grav, y =voc_benzene, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 55, y = 1.2, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 53, y = 1.1, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("benzene") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```


```{r, echo=FALSE, fig.width = 7.5}
# PM vs toluene
pmtol <-  dplyr::filter(per_fuel_mass, grepl('^grav$|^voc_toluene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmtol_pertest <- dplyr::filter(per_test, grepl('^grav$|^voc_toluene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmtol$grav, pmtol$voc_toluene, method = "spearman")
  rho_pear <- cor(pmtol$grav, pmtol$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmtol, aes(x = grav, y = voc_toluene, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = pmtol_pertest, aes(x = grav, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 55, y = 0.24, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 53, y = 0.22, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("toluene") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```


```{r, echo=FALSE, fig.width = 7.5}
# CO vs formaldehyde
cofor <- dplyr::filter(per_fuel_mass, grepl('^co$|^formaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  cofor_pertest <- dplyr::filter(per_test, grepl('^co$|^formaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cofor$co, cofor$formaldehyde, method = "spearman")
  rho_pear <- cor(cofor$co, cofor$formaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cofor, aes(x = co, y = formaldehyde, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = cofor_pertest, aes(x = co, y = formaldehyde, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 18, y = 1.5, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 18, y = 1.4, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
        ylab("formaldehyde") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

### CO vs acetaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 7.5}
  coacet <- dplyr::filter(per_fuel_mass, grepl('^co$|^acetaldehyde$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  coacet_pertest <- dplyr::filter(per_test, grepl('^co$|^acetaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)


 # rho calculations
  rho_sp <- cor(coacet$co, coacet$acetaldehyde, method = "spearman")
  rho_pear <- cor(coacet$co, coacet$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = coacet, aes(x = co, y = acetaldehyde, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = coacet_pertest, aes(x = co, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 18.3, y = 1.1, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 17.5, y = 1.0, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("acetaldehyde") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# CO vs benzene
cobenz <- dplyr::filter(per_fuel_mass, grepl('^co$|^voc_benzene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  cobenz_pertest <- dplyr::filter(per_test, grepl('^co$|^voc_benzene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cobenz$co, cobenz$voc_benzene, method = "spearman")
  rho_pear <- cor(cobenz$co, cobenz$voc_benzene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cobenz, aes(x = co, y = voc_benzene, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = cobenz_pertest, aes(x = co, y = voc_benzene, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 17, y = 1.2, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 17, y = 1.1, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("benzene") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# CO vs toluene
cotol <- dplyr::filter(per_fuel_mass, grepl('^co$|^voc_toluene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  cotol_pertest <- dplyr::filter(per_test, grepl('^co$|^voc_toluene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cotol$co, cotol$voc_toluene, method = "spearman")
  rho_pear <- cor(cotol$co, cotol$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cotol, aes(x = co, y = voc_toluene, colour = fuel_names), 
                     shape = 17, size = 6) +
          geom_point(data = cotol_pertest, aes(x = co, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 4, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 17.0, y = 0.24, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          geom_text(data = rhos, aes(x = 15, y = 0.22, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          ylab("toluene") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size = 20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size = 20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# PM vs MCE
  pmMCE <- dplyr::filter(per_fuel_mass, grepl('^grav$|^MCE$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                          fuel_names == 'kerosene' |
                                          fuel_names == 'wood shims' | 
                                          fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  pmMCE_pertest <- dplyr::filter(per_test, grepl('^grav$|^MCE$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)
 # rho calculations
  rho_sp <- cor(pmMCE$grav, pmMCE$MCE, method = "spearman")
  rho_pear <- cor(pmMCE$grav, pmMCE$MCE, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = pmMCE, aes(x = MCE, y = grav, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = pmMCE_pertest, aes(x = MCE, y = grav, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 97, y = 65, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 97, y = 60, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          xlab("MCE") +
          ylab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# formaldehyde vs MCE
  formMCE <- dplyr::filter(per_fuel_mass, grepl('^formaldehyde$|^MCE$', pol)) %>%
             dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                             fuel_names == 'kerosene' |
                                             fuel_names == 'wood shims' | 
                                             fuel_names == 'kindling', 
                                             'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  formMCE_pertest <- dplyr::filter(per_test, grepl('^formaldehyde$|^MCE$', pol)) %>%
                     dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                     tidyr::spread(pol, mass_pol_per_mass_fuel)
 # rho calculations
  rho_sp <- cor(formMCE$formaldehyde, formMCE$MCE, method = "spearman")
  rho_pear <- cor(formMCE$formaldehyde, formMCE$MCE, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = formMCE, aes(x = MCE, y = formaldehyde, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = formMCE_pertest, aes(x = MCE, y = formaldehyde, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 97, y = 1.45, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 96.8, y = 1.35, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          xlab("MCE") +
          ylab("formaldehyde") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# acetaldehyde vs MCE
  acetMCE <- dplyr::filter(per_fuel_mass, grepl('^acetaldehyde$|^MCE$', pol)) %>%
             dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                             fuel_names == 'kerosene' |
                                             fuel_names == 'wood shims' | 
                                             fuel_names == 'kindling', 
                                             'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  acetMCE_pertest <- dplyr::filter(per_test, grepl('^acetaldehyde$|^MCE$', pol)) %>%
                     dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                     tidyr::spread(pol, mass_pol_per_mass_fuel)
 # rho calculations
  rho_sp <- cor(acetMCE$acetaldehyde, acetMCE$MCE, method = "spearman")
  rho_pear <- cor(acetMCE$acetaldehyde, acetMCE$MCE, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = acetMCE, aes(x = MCE, y = acetaldehyde, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = acetMCE_pertest, aes(x = MCE, y = acetaldehyde, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 97, y = 1.15, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 96.8, y = 1.05, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          xlab("MCE") +
          ylab("acetaldehyde") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# benzene vs MCE
  benzMCE <- dplyr::filter(per_fuel_mass, grepl('^voc_benzene$|^MCE$', pol)) %>%
             dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                             fuel_names == 'kerosene' |
                                             fuel_names == 'wood shims' | 
                                             fuel_names == 'kindling', 
                                             'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  benzMCE_pertest <- dplyr::filter(per_test, grepl('^voc_benzene$|^MCE$', pol)) %>%
                     dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                     tidyr::spread(pol, mass_pol_per_mass_fuel)
 # rho calculations
  rho_sp <- cor(benzMCE$voc_benzene, benzMCE$MCE, method = "spearman")
  rho_pear <- cor(benzMCE$voc_benzene, benzMCE$MCE, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = benzMCE, aes(x = MCE, y = voc_benzene, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = benzMCE_pertest, aes(x = MCE, y = voc_benzene, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 94.4, y = 1.15, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 94.2, y = 1.05, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          xlab("MCE") +
          ylab("benzene") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

```{r, echo=FALSE, fig.width = 7.5}
# toluene vs MCE
  tolMCE <- dplyr::filter(per_fuel_mass, grepl('^voc_toluene$|^MCE$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                            'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  tolMCE_pertest <- dplyr::filter(per_test, grepl('^voc_toluene$|^MCE$', pol)) %>%
                    dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                    tidyr::spread(pol, mass_pol_per_mass_fuel)
 # rho calculations
  rho_sp <- cor(tolMCE$voc_toluene, tolMCE$MCE, method = "spearman")
  rho_pear <- cor(tolMCE$voc_toluene, tolMCE$MCE, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = tolMCE, aes(x = MCE, y = voc_toluene, colour = fuel_names), 
                   shape = 17, size = 6) +
        geom_point(data = tolMCE_pertest, aes(x = MCE, y = voc_toluene, colour = fuel_names), 
                   shape = 1, size = 4, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 94.4, y = 0.24, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
            geom_text(data = rhos, aes(x = 94.25, y = 0.22, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 7) +
          xlab("MCE") +
          ylab("toluene") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 20),
                axis.text=element_text(size=20),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.text = element_text(size=20),
                legend.title = element_blank())
```

---
title: "temp"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_tidy.R")
  source("../r_scripts/R_functions.R")
```

# Load data

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  temp <- readRDS("../r_files/temp.RDS")
```

* metadata

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  test_info <- readRDS("../r_files/test_info.RDS")
  times_fuel <- readRDS("../r_files/times_fuel.RDS")
  times_bg <- readRDS("../r_files/times_bg.RDS")
  times_test <- readRDS("../r_files/times_test.RDS")
  flow <- readRDS("../r_files/flows.RDS")
  notes <- readRDS("../r_files/notes.RDS")
```

# Organize

## sample times

* full test

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  temp_full <- filter_times_startup(times_test, temp)
```

Note tests have data in `t_1` column, except tests `15 20 22 28 34`.

* background levels

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  temp_bg <- filter_times_background(times_bg, temp)
```

* levels by replicate

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  temp_rep <- filter_times_rep(times_fuel, temp)
```

## Info

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  info <- dplyr::select(test_info, id_test, id, fuel_type, fuel_quant)
```

## Longer format

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
 temp_full <- tidyr::gather(temp_full, "t_sensor", "t_flue", 3:6) %>%
              dplyr::filter(!is.na(t_flue)) %>%
              dplyr::left_join(info, by = "id")
```

# QC

## flags from notes

* extract notes

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  notes <- dplyr::filter(notes, grepl("temp|all", notes$notes) == TRUE)
```

# Save merged file

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  saveRDS(temp_full, file = "../r_files/temp_merged.RDS")
```

# Summary

Temperature was measured for `r length(unique(temp$id))` experiments between `r min(temp$date, na.rm = TRUE)` and `r max(temp$date, na.rm = TRUE)`. There is no temperature data for tests: `r setdiff(as.character(test_info$id), as.character(temp$id))`.

Temperature data is expected to be missing for:

# Plots

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width=12, fig.height=60}
  ggplot(temp_full, aes(datetime, t_flue, color = t_sensor)) +
   geom_point() +
   facet_wrap(~id, ncol = 2, scales = "free")
```

